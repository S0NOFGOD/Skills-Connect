<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkillConnect ‚Äî Freelancer</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:'Montserrat', sans-serif; }
  body {
    background: #0D1117;
    color: #F0F6FC;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
  }
  .container {
    max-width: 400px;
    width: 100%;
    background: #161B22;
    padding: 30px 20px;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  }
  h2 { color:#58A6FF; font-weight:700; margin-bottom:20px; text-align:center;}
  input, select, button {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border-radius: 10px;
    border: none;
    font-size: 14px;
  }
  input, select { background:#0D1117; color:#C9D1D9; border:1px solid #30363D; }
  button { cursor:pointer; font-weight:600; transition:0.3s; }
  button:hover { opacity:0.9; }
  .btn-signup { background:#238636; color:#fff; }
  .btn-login { background:#7950F2; color:#fff; }
  .toggle-password { position:absolute; right:20px; top:50%; transform:translateY(-50%); cursor:pointer; }
  .form-group { position:relative; }
  .location-btn { background:#1F6FEB; color:#fff; margin-top:0; }
  .forgot-password { background:none; color:#58A6FF; text-align:center; margin-top:10px; }
  .hidden { display:none; }
  label { display:block; margin-top:8px; font-size:14px; color:#C9D1D9;}
</style>
</head>
<body>
<div class="container">
  <h2>Freelancer</h2>

  <!-- Signup Form -->
  <form id="signupForm">
    <label>Name</label>
    <input type="text" id="signupName" required>

    <label>Email</label>
    <input type="email" id="signupEmail" required>

    <label>Phone Number</label>
    <input type="text" id="signupPhone" required>

    <label>Local Skills</label>
    <select id="signupSkill" required>
      <option value="">Select Skill</option>
      <option value="Plumbing">Plumbing</option>
      <option value="Carpentry">Carpentry</option>
      <option value="Electrician">Electrician</option>
      <option value="Haircutting">Haircutting</option>
      <option value="Cooking">Cooking</option>
      <option value="Gardening">Gardening</option>
      <option value="Cleaning">Cleaning</option>
    </select>

    <label>Upload Image</label>
    <input type="file" id="signupImage" accept="image/*">

    <div class="form-group">
      <label>Password</label>
      <input type="password" id="signupPassword" required>
      <span class="toggle-password" onclick="togglePassword('signupPassword')">üëÅÔ∏è</span>
    </div>

    <div class="form-group">
      <label>Confirm Password</label>
      <input type="password" id="signupConfirmPassword" required>
      <span class="toggle-password" onclick="togglePassword('signupConfirmPassword')">üëÅÔ∏è</span>
    </div>

    <label>Location</label>
    <input type="text" id="signupLocation" readonly placeholder="Click find my location">
    <button type="button" class="location-btn" onclick="getLocation()">Find My Location</button>

    <button type="submit" class="btn-signup">Sign Up</button>
  </form>

  <!-- Login Form -->
  <form id="loginForm" class="hidden">
    <label>Email</label>
    <input type="email" id="loginEmail" required>
    <label>Password</label>
    <div class="form-group">
      <input type="password" id="loginPassword" required>
      <span class="toggle-password" onclick="togglePassword('loginPassword')">üëÅÔ∏è</span>
    </div>
    <button type="submit" class="btn-login">Login</button>
    <button type="button" class="forgot-password" onclick="showForgot()">Forgot Password?</button>
  </form>

  <!-- Forgot Password -->
  <form id="forgotForm" class="hidden">
    <label>Email</label>
    <input type="email" id="forgotEmail" required>
    <button type="button" class="btn-login" onclick="sendResetCode()">Send Reset Code</button>

    <div id="resetSection" class="hidden">
      <label>Reset Code</label>
      <input type="text" id="resetCode">
      <label>New Password</label>
      <input type="password" id="newPassword">
      <label>Confirm Password</label>
      <input type="password" id="confirmNewPassword">
      <button type="button" class="btn-signup" onclick="updatePassword()">Update Password</button>
    </div>
  </form>

  <p style="margin-top:15px; text-align:center; color:#58A6FF; cursor:pointer;" onclick="toggleForms()">Already have an account? Login</p>
</div>

<script>
emailjs.init("PpXJtmBS2cd6k1qfT");

function toggleForms(){
  document.getElementById('signupForm').classList.toggle('hidden');
  document.getElementById('loginForm').classList.toggle('hidden');
  document.getElementById('forgotForm').classList.add('hidden');
}

function togglePassword(id){
  const input = document.getElementById(id);
  input.type = input.type === 'password' ? 'text' : 'password';
}

// ====== Location ======
function getLocation(){
  const locInput = document.getElementById('signupLocation');
  locInput.value = "Loading, hold on...";
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(async (pos)=>{
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      // Reverse geocoding using OpenStreetMap Nominatim
      const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`);
      const data = await res.json();
      locInput.value = `${data.address.city || data.address.town || data.address.village}, ${data.address.state || ''}`;
    }, ()=>{
      locInput.value = "Unable to fetch location";
    });
  } else {
    locInput.value = "Geolocation not supported";
  }
}

// ====== Signup ======
document.getElementById('signupForm').addEventListener('submit', function(e){
  e.preventDefault();
  const name = document.getElementById('signupName').value.trim();
  const email = document.getElementById('signupEmail').value.trim();
  const phone = document.getElementById('signupPhone').value.trim();
  const skill = document.getElementById('signupSkill').value;
  const image = document.getElementById('signupImage').files[0];
  const password = document.getElementById('signupPassword').value;
  const confirm = document.getElementById('signupConfirmPassword').value;
  const location = document.getElementById('signupLocation').value;

  if(!name || !email || !phone || !skill || !password || !confirm || !location){
    alert('Please fill all fields');
    return;
  }
  if(password !== confirm){
    alert('Passwords do not match');
    return;
  }

  const reader = new FileReader();
  reader.onload = function(){
    const imageData = reader.result;
    const users = JSON.parse(localStorage.getItem('freelancers') || '[]');
    users.push({name,email,phone,skill,image:imageData,password,location});
    localStorage.setItem('freelancers', JSON.stringify(users));
    alert('Signup successful!');
    window.location.href = 'freelancerdashboard.html';
  };
  if(image) reader.readAsDataURL(image);
  else {
    const users = JSON.parse(localStorage.getItem('freelancers') || '[]');
    users.push({name,email,phone,skill,image:'',password,location});
    localStorage.setItem('freelancers', JSON.stringify(users));
    alert('Signup successful!');
    window.location.href = 'freelancerdashboard.html';
  }
});

// ====== Login ======
document.getElementById('loginForm').addEventListener('submit', function(e){
  e.preventDefault();
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;
  const users = JSON.parse(localStorage.getItem('freelancers') || '[]');
  const user = users.find(u => u.email === email && u.password === password);
  if(user){
    localStorage.setItem('currentFreelancer', JSON.stringify(user));
    alert('Login successful!');
    window.location.href = 'freelancerdashboard.html';
  } else {
    alert('Invalid credentials');
  }
});

// ====== Forgot Password ======
function showForgot(){
  document.getElementById('loginForm').classList.add('hidden');
  document.getElementById('forgotForm').classList.remove('hidden');
}

let generatedCode = '';
function sendResetCode(){
  const email = document.getElementById('forgotEmail').value.trim();
  if(!email) { alert('Enter your email'); return; }
  generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
  emailjs.send('service_w7msx75','template_d67hhwh',{
    to_email: email,
    reset_code: generatedCode
  }).then(()=> {
    alert('Reset code sent to email!');
    document.getElementById('resetSection').classList.remove('hidden');
  }, ()=>{ alert('Failed to send reset code'); });
}

function updatePassword(){
  const code = document.getElementById('resetCode').value.trim();
  const newPass = document.getElementById('newPassword').value;
  const confirmPass = document.getElementById('confirmNewPassword').value;

  if(code !== generatedCode){ alert('Invalid code'); return; }
  if(!newPass || !confirmPass){ alert('Enter password'); return; }
  if(newPass !== confirmPass){ alert('Passwords do not match'); return; }

  const email = document.getElementById('forgotEmail').value.trim();
  const users = JSON.parse(localStorage.getItem('freelancers') || '[]');
  const userIndex = users.findIndex(u=>u.email===email);
  if(userIndex>=0){
    users[userIndex].password = newPass;
    localStorage.setItem('freelancers', JSON.stringify(users));
    localStorage.setItem('currentFreelancer', JSON.stringify(users[userIndex]));
    alert('Password updated!');
    window.location.href = 'freelancerdashboard.html';
  } else alert('Email not found');
}
</script>
</body>
</html>
