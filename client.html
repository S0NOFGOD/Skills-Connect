<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<title>SkillConnect Client</title>

<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<script>
(function(){
emailjs.init("PpXJtmBS2cd6k1qfT");
})();
</script>

</head>
<body>

<div class="mobile-container">

<h2 style="margin-bottom:20px;">Client</h2>

<!-- SIGNUP -->

<div id="signupCard" class="card">

<input id="su_name" class="input" placeholder="Full Name">

<input id="su_email" class="input" placeholder="Email">

<input id="su_password" type="password" class="input" placeholder="Password">

<input id="su_confirm" type="password" class="input" placeholder="Confirm Password">

<button class="btn" onclick="signup()">Sign Up</button>

<br><br>

<button class="btn" onclick="showLogin()">Login Instead</button>

</div>


<!-- LOGIN -->

<div id="loginCard" class="card" style="display:none;">

<input id="li_email" class="input" placeholder="Email">

<input id="li_password" type="password" class="input" placeholder="Password">

<button class="btn" onclick="login()">Login</button>

<br><br>

<button class="btn" onclick="showForgot()">Forgot Password</button>

</div>


<!-- FORGOT PASSWORD -->

<div id="forgotCard" class="card" style="display:none;">

<input id="fp_email" class="input" placeholder="Email">

<button class="btn" onclick="sendReset()">Send Reset Code</button>

<div id="resetFields" style="display:none;">

<input id="fp_code" class="input" placeholder="Enter Code">

<input id="fp_newpass" type="password" class="input" placeholder="New Password">

<input id="fp_confirmpass" type="password" class="input" placeholder="Confirm Password">

<button class="btn" onclick="updatePassword()">Update Password</button>

</div>

</div>

</div>

<script src="js/app.js"></script>

<script>

let resetCode=null;
let resetEmail=null;


// SIGNUP

function signup(){

let name=su_name.value.trim();
let email=su_email.value.trim();
let password=su_password.value;
let confirm=su_confirm.value;

if(!name||!email||!password||!confirm){
alert("Complete all fields");
return;
}

if(password!==confirm){
alert("Passwords do not match");
return;
}

let clients=getClients();

if(clients.find(u=>u.email===email)){
alert("Email exists");
return;
}

let user={
name,
email,
password
};

clients.push(user);

saveClients(clients);

setSession(user,"client");

location.href="clientdashboard.html";

}


// LOGIN

function login(){

let email=li_email.value;
let password=li_password.value;

let clients=getClients();

let user=clients.find(u=>
u.email===email && u.password===password);

if(!user){
alert("Invalid login");
return;
}

setSession(user,"client");

location.href="clientdashboard.html";

}


// SHOW LOGIN

function showLogin(){

signupCard.style.display="none";
loginCard.style.display="block";

}


// SHOW FORGOT

function showForgot(){

loginCard.style.display="none";
forgotCard.style.display="block";

}


// SEND RESET

function sendReset(){

let email=fp_email.value;

let clients=getClients();

let user=clients.find(u=>u.email===email);

if(!user){
alert("Email not found");
return;
}

resetCode=generateCode();
resetEmail=email;

emailjs.send(
"service_w7msx75",
"template_d67hhwh",
{
to_email:email,
reset_code:resetCode
}
);

alert("Reset code sent");

resetFields.style.display="block";

}


// UPDATE PASSWORD

function updatePassword(){

let code=fp_code.value;
let newpass=fp_newpass.value;
let confirm=fp_confirmpass.value;

if(code!=resetCode){
alert("Invalid code");
return;
}

if(newpass!==confirm){
alert("Passwords do not match");
return;
}

let clients=getClients();

let user=clients.find(u=>u.email===resetEmail);

user.password=newpass;

saveClients(clients);

setSession(user,"client");

location.href="clientdashboard.html";

}

</script>

</body>
</html>
